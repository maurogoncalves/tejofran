<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
class Infracao extends CI_Controller {
 function __construct(){   parent::__construct();   $this->load->model('infracao_model','',TRUE);		   $this->load->model('sublocacao_model','',TRUE);	   $this->load->model('log_model','',TRUE);   $this->load->model('tipo_emitente_model','',TRUE);   $this->load->model('user','',TRUE);   $this->load->model('contratante','',TRUE);   $this->load->model('emitente_model','',TRUE);   $this->load->model('loja_model','',TRUE);   $this->load->library('session');   $this->load->library('form_validation');   $this->load->helper('url');   session_start();	    //date_default_timezone_set('America/Sao_Paulo');	
} function index() {   if($_SESSION['login'])   {     $session_data = $_SESSION['login'];     $data['email'] = $session_data['email'];	 $data['empresa'] = $session_data['empresa'];	 $data['perfil'] = $session_data['perfil'];     $this->load->view('home_view', $data);   }else{     //If no session, redirect to login page     redirect('login', 'refresh');   } } 
function listar(){	$session_data = $_SESSION['login'];	$idContratante = $_SESSION['cliente'] ;	$data['estados'] = $this->infracao_model->buscaEstado($idContratante);	$data['cidades'] = $this->infracao_model->buscaCidade($idContratante);	$data['lojas'] = $this->infracao_model->listarLojasComInfra($idContratante);	if(empty($_POST)){		$cidade = '';		$estado = '';				$result = $this->infracao_model->listarInfracao($idContratante);	}else{		$estadoListar = $_POST['estadoListar'];		$municipioListar = $_POST['municipioListar'];		$idImovelListar = $_POST['idImovelListar'];		if($idImovelListar == '0'){				if($municipioListar <> '0'){				$result = $this->infracao_model->listarInfracaoByCidade($idContratante,$municipioListar);			}else if($estadoListar <> '0'){				$result = $this->infracao_model->listarInfracaoByEstado($idContratante,$estadoListar);							}else{				$result = $this->infracao_model->listarInfracao($idContratante);			}		}else{				$result = $this->infracao_model->listarInfracaoByIdLoja($idImovelListar);		}	}	//print_r($this->db->last_query());exit;	$total =  $this->infracao_model->somarTodos($idContratante);	//print_r($total);exit;	if(empty($_SESSION["cidadeInfra"])){		$data['cidadeBD'] = 0;	}else{		$data['cidadeBD'] = $_SESSION["cidadeInfra"];	}	if(empty($_SESSION["estadoInfra"])){		$data['estadoBD'] = 0;		}else{		$data['estadoBD'] =$_SESSION["estadoInfra"];	}	if(empty($_SESSION["idInfraL"])){		$data['idInfraL'] = 0;	}else{		$data['idInfraL'] = $_SESSION["idInfraL"];	}		if(empty($_SESSION["mensagemInfra"])){		$data['mensagemInfra'] = '';	}else{		$data['mensagemInfra'] = $_SESSION['mensagemInfra'];	}			if(empty($session_data['visitante'])){		$data['visitante'] = 0;	}else{		$data['visitante'] = $session_data['visitante'];		}			$data['infracoes'] = $result;	$data['perfil'] = $session_data['perfil'];	$this->load->view('header_pages_view',$data);    $this->load->view('listar_infracoes_view', $data);	$this->load->view('footer_pages_view');}
}
?>
